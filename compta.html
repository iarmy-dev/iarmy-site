<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Configuration Compta - iArmy</title>
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' rx='20' fill='%23FF6B35'/><text x='50' y='68' font-family='Arial' font-size='55' font-weight='bold' fill='white' text-anchor='middle'>i</text></svg>">
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    * { font-family: 'Space Grotesk', sans-serif; margin: 0; padding: 0; box-sizing: border-box; }
    body { background: #030303; color: white; min-height: 100vh; overflow-x: hidden; }
    
    /* Background gradient anim√© */
    .bg-gradient-animate { 
      background: linear-gradient(135deg, #030303 0%, #0a0508 25%, #050808 50%, #080805 75%, #030303 100%); 
      background-size: 400% 400%; 
      animation: gradientShift 20s ease infinite; 
    }
    @keyframes gradientShift { 
      0% { background-position: 0% 50%; } 
      50% { background-position: 100% 50%; } 
      100% { background-position: 0% 50%; } 
    }
    
    /* ORBES COLOR√âS BIEN VISIBLES (moins sombre) */
    .orb { 
      position: fixed; 
      border-radius: 50%; 
      filter: blur(100px); 
      animation: float 15s ease-in-out infinite; 
      pointer-events: none; 
      z-index: 0; 
    }
    .orb-1 { 
      width: 500px; 
      height: 500px; 
      background: linear-gradient(135deg, #FF6B35, #FF8B5E); 
      top: -250px; 
      right: -150px; 
      opacity: 0.18; /* PLUS VISIBLE */
    }
    .orb-2 { 
      width: 400px; 
      height: 400px; 
      background: linear-gradient(135deg, #6B35FF, #8B5EFF); 
      bottom: -200px; 
      left: -150px; 
      opacity: 0.18; /* PLUS VISIBLE */
      animation-delay: -7s; 
    }
    .orb-3 { 
      width: 250px; 
      height: 250px; 
      background: linear-gradient(135deg, #35FFB8, #5EFFD4); 
      top: 40%; 
      left: 40%; 
      opacity: 0.1; /* PLUS VISIBLE */
      animation-delay: -3s; 
    }
    @keyframes float { 
      0%, 100% { transform: translate(0, 0) scale(1); } 
      33% { transform: translate(30px, -30px) scale(1.05); } 
      66% { transform: translate(-20px, 20px) scale(0.95); } 
    }
    
    /* Glass effects */
    .glass-card { 
      background: rgba(255, 255, 255, 0.02); 
      backdrop-filter: blur(24px); 
      -webkit-backdrop-filter: blur(24px); 
      border: 1px solid rgba(255, 255, 255, 0.06); 
      border-radius: 24px; 
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5); 
      transition: all 0.4s ease; 
    }
    .glass-card:hover { 
      background: rgba(255, 255, 255, 0.03); 
      border-color: rgba(255, 255, 255, 0.1); 
      transform: translateY(-2px); 
    }
    
    /* Logo i - EFFET PLUS PRONONC√â */
    .logo-i { 
      width: 40px; 
      height: 40px; 
      background: linear-gradient(135deg, #FF6B35 0%, #FF8B5E 50%, #FFB088 100%); 
      border-radius: 11px; 
      display: flex; 
      align-items: center; 
      justify-content: center; 
      font-weight: 700; 
      font-size: 18px; 
      transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275); 
      box-shadow: 0 4px 15px rgba(255, 107, 53, 0.25); 
      cursor: pointer;
    }
    .logo-i:hover { 
      transform: scale(1.2) rotate(-15deg); /* PLUS PRONONC√â ! */
      box-shadow: 0 12px 40px rgba(255, 107, 53, 0.5); 
    }
    
    /* Sidebar */
    .sidebar { 
      background: rgba(255, 255, 255, 0.01); 
      backdrop-filter: blur(20px); 
      border-right: 1px solid rgba(255, 255, 255, 0.04); 
      width: 280px; 
      min-height: 100vh; 
      padding: 24px; 
      position: fixed; 
      left: 0; 
      top: 0; 
      z-index: 50; 
    }
    
    /* Steps */
    .step-item { 
      display: flex; 
      align-items: center; 
      gap: 14px; 
      padding: 14px 16px; 
      border-radius: 12px; 
      margin-bottom: 8px; 
      transition: all 0.3s ease; 
    }
    .step-item.active { background: rgba(255, 107, 53, 0.08); }
    .step-item.completed { opacity: 0.5; }
    .step-item.upcoming { opacity: 0.3; }
    
    .step-number { 
      width: 32px; 
      height: 32px; 
      border-radius: 50%; 
      display: flex; 
      align-items: center; 
      justify-content: center; 
      font-weight: 600; 
      font-size: 14px; 
      background: rgba(255, 255, 255, 0.03); 
      border: 2px solid rgba(255, 255, 255, 0.08); 
      transition: all 0.3s ease;
    }
    .step-item.active .step-number { 
      background: linear-gradient(135deg, #FF6B35, #FF8B5E); 
      border-color: transparent; 
      box-shadow: 0 0 20px rgba(255, 107, 53, 0.3); 
    }
    .step-item.completed .step-number { 
      background: linear-gradient(135deg, #22c55e, #4ade80); 
      border-color: transparent; 
    }
    
    .step-label { 
      font-size: 14px; 
      font-weight: 500; 
      color: rgba(255, 255, 255, 0.5); 
      transition: all 0.3s ease;
    }
    .step-item.active .step-label { color: white; }
    
    /* Main content */
    .main-content { 
      margin-left: 280px; 
      padding: 40px; 
      max-width: 900px; 
      position: relative; 
      z-index: 10; 
    }
    
    /* Steps content */
    .step-content { display: none; animation: fadeIn 0.4s ease; }
    .step-content.active { display: block; }
    @keyframes fadeIn { 
      from { opacity: 0; transform: translateY(10px); } 
      to { opacity: 1; transform: translateY(0); } 
    }
    
    /* Options Grid */
    .options-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 24px;
      margin-top: 40px;
    }
    
    .option-card {
      padding: 32px;
      border-radius: 20px;
      cursor: pointer;
      transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }
    
    .option-card.google {
      background: linear-gradient(135deg, rgba(15, 157, 88, 0.12) 0%, rgba(52, 168, 83, 0.06) 100%);
      border: 2px solid rgba(52, 168, 83, 0.3);
    }
    
    .option-card.google:hover {
      background: linear-gradient(135deg, rgba(15, 157, 88, 0.18) 0%, rgba(52, 168, 83, 0.1) 100%);
      border-color: rgba(52, 168, 83, 0.5);
      transform: translateY(-8px) scale(1.02);
      box-shadow: 0 12px 40px rgba(52, 168, 83, 0.3);
    }
    
    .option-card.excel {
      background: rgba(255,255,255,0.02);
      border: 2px solid rgba(255,255,255,0.06);
    }
    
    .option-card.excel:hover {
      background: rgba(255,255,255,0.04);
      border-color: rgba(255,255,255,0.1);
      transform: translateY(-8px) scale(1.02);
      box-shadow: 0 12px 40px rgba(255,255,255,0.1);
    }
    
    .badge {
      display: inline-block;
      padding: 6px 14px;
      border-radius: 20px;
      font-size: 11px;
      font-weight: 700;
      text-transform: uppercase;
      margin-bottom: 16px;
      letter-spacing: 0.5px;
      animation: pulse 2s ease-in-out infinite;
    }
    
    @keyframes pulse {
      0%, 100% { opacity: 1; transform: scale(1); }
      50% { opacity: 0.8; transform: scale(1.05); }
    }
    
    .badge.recommended {
      background: rgba(52, 168, 83, 0.2);
      color: #34a853;
    }
    
    /* VRAI BOUTON GOOGLE OAUTH */
    .btn-google-oauth {
      width: 100%;
      background: white;
      color: #3c4043;
      border: none;
      border-radius: 4px;
      padding: 0;
      font-family: 'Roboto', arial, sans-serif;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      box-shadow: 0 1px 2px 0 rgba(60,64,67,.30), 0 1px 3px 1px rgba(60,64,67,.15);
      display: flex;
      align-items: center;
      justify-content: center;
      height: 40px;
      position: relative;
      overflow: hidden;
    }
    
    .btn-google-oauth::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      border-radius: 50%;
      background: rgba(66, 133, 244, 0.1);
      transform: translate(-50%, -50%);
      transition: width 0.6s, height 0.6s;
    }
    
    .btn-google-oauth:hover::before {
      width: 300px;
      height: 300px;
    }
    
    .btn-google-oauth:hover {
      box-shadow: 0 1px 3px 0 rgba(60,64,67,.30), 0 4px 8px 3px rgba(60,64,67,.15);
      background: #f8f9fa;
      transform: translateY(-2px);
    }
    
    .btn-google-oauth:active {
      background: #f1f3f4;
      transform: translateY(0);
    }
    
    .google-icon {
      width: 18px;
      height: 18px;
      margin-right: 8px;
      position: relative;
      z-index: 1;
    }
    
    .btn-text {
      position: relative;
      z-index: 1;
    }
    
    /* Boutons secondaires */
    .btn-secondary { 
      background: rgba(255, 255, 255, 0.04); 
      border: 1px solid rgba(255, 255, 255, 0.08); 
      border-radius: 14px; 
      padding: 16px 28px; 
      color: white; 
      font-weight: 600; 
      cursor: pointer; 
      transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); 
      width: 100%;
      font-size: 15px;
      position: relative;
      overflow: hidden;
    }
    
    .btn-secondary::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
      transition: left 0.6s ease;
    }
    
    .btn-secondary:hover::before {
      left: 100%;
    }
    
    .btn-secondary:hover { 
      background: rgba(255, 255, 255, 0.08); 
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(255, 255, 255, 0.1);
    }
    
    .btn-primary { 
      background: linear-gradient(135deg, #FF6B35, #FF8B5E); 
      border: none; 
      border-radius: 14px; 
      padding: 16px 28px; 
      color: white; 
      font-weight: 600; 
      cursor: pointer; 
      position: relative; 
      overflow: hidden; 
      transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); 
      box-shadow: 0 4px 15px rgba(255, 107, 53, 0.25); 
      width: 100%; 
      font-size: 15px; 
    }
    
    .btn-primary::before { 
      content: ''; 
      position: absolute; 
      top: 0; 
      left: -100%; 
      width: 100%; 
      height: 100%; 
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent); 
      transition: left 0.6s ease; 
    }
    
    .btn-primary:hover { 
      transform: translateY(-4px) scale(1.02); 
      box-shadow: 0 12px 35px rgba(255, 107, 53, 0.5); 
    }
    .btn-primary:hover::before { left: 100%; }
    
    /* Upload Zone */
    .upload-zone { 
      border: 2px dashed rgba(255, 255, 255, 0.1); 
      border-radius: 24px; 
      padding: 60px 40px; 
      text-align: center; 
      transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); 
      cursor: pointer; 
      background: rgba(255, 255, 255, 0.01); 
      margin-top: 24px;
    }
    .upload-zone:hover { 
      border-color: rgba(255, 107, 53, 0.4); 
      background: rgba(255, 107, 53, 0.03); 
      transform: scale(1.02);
      box-shadow: 0 8px 30px rgba(255, 107, 53, 0.2);
    }
    .upload-zone.dragover { 
      border-color: #FF6B35; 
      background: rgba(255, 107, 53, 0.08); 
      transform: scale(1.05);
    }
    
    /* Form inputs */
    .input-glass { 
      background: rgba(255, 255, 255, 0.04); 
      border: 1px solid rgba(255, 255, 255, 0.08); 
      border-radius: 14px; 
      padding: 16px 20px; 
      color: white; 
      font-size: 15px; 
      width: 100%; 
      transition: all 0.3s ease;
    }
    .input-glass:focus { 
      outline: none; 
      border-color: rgba(255, 107, 53, 0.4); 
      box-shadow: 0 0 0 3px rgba(255, 107, 53, 0.1);
      background: rgba(255, 255, 255, 0.06);
    }
    .input-glass::placeholder { 
      color: rgba(255, 255, 255, 0.25); 
    }
    
    /* Responsive */
    @media (max-width: 768px) {
      .sidebar { display: none; }
      .main-content { margin-left: 0; padding: 30px 20px; }
      .options-grid { grid-template-columns: 1fr; }
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
  </style>
</head>
<body class="bg-gradient-animate">
  <!-- Orbes color√©s -->
  <div class="orb orb-1"></div>
  <div class="orb orb-2"></div>
  <div class="orb orb-3"></div>
  
  <!-- Sidebar -->
  <aside class="sidebar">
    <a href="index.html" style="display: flex; align-items: center; gap: 12px; text-decoration: none; color: white; margin-bottom: 48px;">
      <div class="logo-i">i</div>
      <span style="font-weight: 600; font-size: 17px;">iArmy</span>
    </a>
    
    <div class="steps">
      <div class="step-item active" data-step="1">
        <div class="step-number">1</div>
        <div class="step-label">Ton fichier</div>
      </div>
      
      <div class="step-item upcoming" data-step="2">
        <div class="step-number">2</div>
        <div class="step-label">On discute</div>
      </div>
      
      <div class="step-item upcoming" data-step="3">
        <div class="step-number">3</div>
        <div class="step-label">Ton compte</div>
      </div>
      
      <div class="step-item upcoming" data-step="4">
        <div class="step-number">4</div>
        <div class="step-label">Telegram</div>
      </div>
    </div>
  </aside>

  <!-- Main Content -->
  <main class="main-content">
    
    <!-- √âtape 1 -->
    <div id="step-1" class="step-content active">
      <h1 style="font-size: 42px; font-weight: 800; margin-bottom: 12px; line-height: 1.2;">Configure ton robot comptable</h1>
      <p style="color: rgba(255,255,255,0.4); font-size: 18px;">Choisis comment tu veux g√©rer ta compta</p>
      
      <div class="options-grid">
        <!-- Google Sheets -->
        <div class="option-card google glass-card" onclick="connectGoogleSheets()">
          <span class="badge recommended">Recommand√©</span>
          <div style="font-size: 56px; margin-bottom: 20px;">üìä</div>
          <h3 style="font-size: 24px; font-weight: 700; margin-bottom: 12px;">Google Sheets</h3>
          <p style="color: rgba(255,255,255,0.5); font-size: 14px; line-height: 1.6; margin-bottom: 28px;">
            Connecte ton Google Sheets ou on en cr√©e un nouveau. Tout en ligne, accessible partout, sauvegarde auto.
          </p>
          <button class="btn-google-oauth">
            <svg class="google-icon" viewBox="0 0 24 24"><path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/><path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/><path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>
            <span class="btn-text">Connecter avec Google</span>
          </button>
        </div>

        <!-- Upload Excel -->
        <div class="option-card excel glass-card" onclick="showUploadZone()">
          <div style="font-size: 56px; margin-bottom: 20px;">üìÅ</div>
          <h3 style="font-size: 24px; font-weight: 700; margin-bottom: 12px;">Upload mon Excel</h3>
          <p style="color: rgba(255,255,255,0.5); font-size: 14px; line-height: 1.6; margin-bottom: 28px;">
            Tu as d√©j√† un fichier Excel ? On le transfert sur Google Sheets pour que le bot puisse √©crire dedans.
          </p>
          <button class="btn-secondary">
            üì§ Envoyer mon Excel
          </button>
        </div>
      </div>

      <!-- Upload Zone -->
      <div id="upload-zone-container" style="display: none; max-width: 600px;">
        <div class="upload-zone" id="upload-zone">
          <input type="file" id="file-input" accept=".xlsx,.xls" style="display: none;">
          <div style="font-size: 72px; margin-bottom: 20px;">üìä</div>
          <h3 style="font-size: 22px; font-weight: 600; margin-bottom: 8px;">Glisse ton fichier Excel ici</h3>
          <p style="color: rgba(255,255,255,0.3); font-size: 14px;">ou clique pour parcourir</p>
          <p style="color: rgba(255,255,255,0.2); font-size: 13px; margin-top: 16px;">.xlsx ou .xls</p>
        </div>
        <p style="color: rgba(255,255,255,0.3); font-size: 14px; margin-top: 16px; text-align: center;">
          üîí Tes donn√©es restent 100% priv√©es. TOI SEUL y as acc√®s.
        </p>
      </div>
    </div>

    <!-- √âtape 2 -->
    <div id="step-2" class="step-content">
      <h1 style="font-size: 42px; font-weight: 800; margin-bottom: 12px;">Analyse en cours...</h1>
      <p style="color: rgba(255,255,255,0.4); font-size: 18px; margin-bottom: 48px;">Notre IA v√©rifie que tout est parfait √† 100%</p>
      
      <div class="glass-card" style="padding: 48px; max-width: 600px;">
        <div id="analysis-progress">
          <div style="display: flex; align-items: center; gap: 20px; margin-bottom: 24px;">
            <div style="width: 48px; height: 48px; border: 3px solid #FF6B35; border-top-color: transparent; border-radius: 50%; animation: spin 1s linear infinite;"></div>
            <div>
              <div style="font-weight: 600; font-size: 16px; margin-bottom: 6px;">Conversion en cours...</div>
              <div style="font-size: 14px; color: rgba(255,255,255,0.4);">Excel ‚Üí Google Sheets</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- √âtape 3 -->
    <div id="step-3" class="step-content">
      <h1 style="font-size: 42px; font-weight: 800; margin-bottom: 12px;">Cr√©e ton compte</h1>
      <p style="color: rgba(255,255,255,0.4); font-size: 18px; margin-bottom: 48px;">Pour activer ton robot comptable</p>
      
      <div style="max-width: 480px;">
        <button class="btn-google-oauth" onclick="loginWithGoogle()" style="margin-bottom: 32px;">
          <svg class="google-icon" viewBox="0 0 24 24"><path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/><path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/><path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>
          <span class="btn-text">Continuer avec Google</span>
        </button>
        
        <div style="text-align: center; color: rgba(255,255,255,0.2); margin-bottom: 32px; font-size: 14px;">ou</div>
        
        <div style="margin-bottom: 20px;">
          <input type="email" id="email" class="input-glass" placeholder="üìß  Email">
        </div>
        
        <div style="margin-bottom: 24px;">
          <input type="password" id="password" class="input-glass" placeholder="üîí  Mot de passe">
        </div>
        
        <button class="btn-primary" onclick="createAccount()" style="margin-bottom: 40px;">
          Cr√©er mon compte
        </button>

        <div class="glass-card" style="padding: 28px; text-align: center; background: rgba(255,107,53,0.05); border-color: rgba(255,107,53,0.15);">
          <div style="font-size: 32px; margin-bottom: 12px;">üéÅ</div>
          <div style="font-size: 14px; color: rgba(255,255,255,0.5); margin-bottom: 8px;">7 jours d'essai gratuit</div>
          <div style="font-size: 28px; font-weight: 700; background: linear-gradient(135deg, #FF6B35, #FF8B5E); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin-bottom: 4px;">39‚Ç¨/mois</div>
          <div style="font-size: 13px; color: rgba(255,255,255,0.3);">Sans engagement ‚Ä¢ Annulable √† tout moment</div>
        </div>
      </div>
    </div>

    <!-- √âtape 4 -->
    <div id="step-4" class="step-content">
      <div style="text-align: center; max-width: 650px; margin: 0 auto;">
        <div style="font-size: 96px; margin-bottom: 32px;">üéâ</div>
        <h1 style="font-size: 42px; font-weight: 800; margin-bottom: 16px;">C'est pr√™t !</h1>
        <p style="color: rgba(255,255,255,0.4); font-size: 18px; margin-bottom: 56px;">Derni√®re √©tape : connecte ton Telegram</p>
        
        <div class="glass-card" style="padding: 48px; text-align: left;">
          <h3 style="font-size: 22px; font-weight: 700; margin-bottom: 40px; text-align: center;">Comment faire ?</h3>
          
          <div style="display: flex; align-items: start; gap: 24px; margin-bottom: 28px;">
            <div style="width: 48px; height: 48px; background: linear-gradient(135deg, #FF6B35, #FF8B5E); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 20px; flex-shrink: 0; box-shadow: 0 4px 15px rgba(255,107,53,0.3);">1</div>
            <div style="padding-top: 6px;">
              <div style="font-weight: 600; font-size: 16px; margin-bottom: 6px;">Ouvre Telegram</div>
              <div style="font-size: 14px; color: rgba(255,255,255,0.4);">Sur ton t√©l√©phone ou ordinateur</div>
            </div>
          </div>
          
          <div style="display: flex; align-items: start; gap: 24px; margin-bottom: 28px;">
            <div style="width: 48px; height: 48px; background: linear-gradient(135deg, #FF6B35, #FF8B5E); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 20px; flex-shrink: 0; box-shadow: 0 4px 15px rgba(255,107,53,0.3);">2</div>
            <div style="padding-top: 6px;">
              <div style="font-weight: 600; font-size: 16px; margin-bottom: 6px;">Cherche @iArmyComptaBot</div>
              <div style="font-size: 14px; color: rgba(255,255,255,0.4);">Dans la barre de recherche Telegram</div>
            </div>
          </div>
          
          <div style="display: flex; align-items: start; gap: 24px; margin-bottom: 40px;">
            <div style="width: 48px; height: 48px; background: linear-gradient(135deg, #FF6B35, #FF8B5E); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 20px; flex-shrink: 0; box-shadow: 0 4px 15px rgba(255,107,53,0.3);">3</div>
            <div style="padding-top: 6px;">
              <div style="font-weight: 600; font-size: 16px; margin-bottom: 6px;">Envoie /start</div>
              <div style="font-size: 14px; color: rgba(255,255,255,0.4);">Le bot va se connecter automatiquement</div>
            </div>
          </div>
          
          <a href="https://t.me/iArmyComptaBot" target="_blank" class="btn-primary" style="text-decoration: none; display: block; text-align: center;">
            Ouvrir Telegram
          </a>
        </div>
      </div>
    </div>

  </main>

  <script>
    const SUPABASE_URL = 'https://byqfnpdcnifauhwgetcq.supabase.co';
    const SUPABASE_ANON_KEY = 'sb_publishable_8mpFx9ubrV29KfKtgAb3eg_dyazidfT';
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    function goToStep(step) {
      document.querySelectorAll('.step-item').forEach((item, i) => {
        item.classList.remove('active', 'completed', 'upcoming');
        if (i < step - 1) item.classList.add('completed');
        else if (i === step - 1) item.classList.add('active');
        else item.classList.add('upcoming');
      });
      
      document.querySelectorAll('.step-content').forEach(content => {
        content.classList.remove('active');
      });
      document.getElementById(`step-${step}`).classList.add('active');
    }

    async function connectGoogleSheets() {
      const { error } = await supabase.auth.signInWithOAuth({
        provider: 'google',
        options: {
          scopes: 'https://www.googleapis.com/auth/spreadsheets https://www.googleapis.com/auth/drive.file',
          redirectTo: window.location.href + '?connected=true'
        }
      });
      
      if (error) alert('Erreur: ' + error.message);
    }

    function showUploadZone() {
      document.getElementById('upload-zone-container').style.display = 'block';
      
      const uploadZone = document.getElementById('upload-zone');
      const fileInput = document.getElementById('file-input');
      
      uploadZone.onclick = () => fileInput.click();
      
      fileInput.onchange = (e) => {
        if (e.target.files[0]) {
          handleFileUpload(e.target.files[0]);
        }
      };
      
      uploadZone.ondragover = (e) => {
        e.preventDefault();
        uploadZone.classList.add('dragover');
      };
      
      uploadZone.ondragleave = () => {
        uploadZone.classList.remove('dragover');
      };
      
      uploadZone.ondrop = (e) => {
        e.preventDefault();
        uploadZone.classList.remove('dragover');
        if (e.dataTransfer.files[0]) {
          handleFileUpload(e.dataTransfer.files[0]);
        }
      };
    }

    function handleFileUpload(file) {
      goToStep(2);
      
      setTimeout(() => {
        document.getElementById('analysis-progress').innerHTML = `
          <div style="margin-bottom: 20px; display: flex; align-items: center; justify-content: space-between; padding: 16px; background: rgba(34,197,94,0.05); border-radius: 12px;">
            <span style="font-weight: 600;">‚úÖ Conversion termin√©e</span>
            <span style="color: #22c55e; font-weight: 600;">100%</span>
          </div>
          <div style="margin-bottom: 20px; display: flex; align-items: center; justify-content: space-between; padding: 16px; background: rgba(34,197,94,0.05); border-radius: 12px;">
            <span style="font-weight: 600;">‚úÖ V√©rification IA</span>
            <span style="color: #22c55e;">1 247 cellules</span>
          </div>
          <div style="margin-bottom: 20px; display: flex; align-items: center; justify-content: space-between; padding: 16px; background: rgba(34,197,94,0.05); border-radius: 12px;">
            <span style="font-weight: 600;">‚úÖ Formules valid√©es</span>
            <span style="color: #22c55e;">15 formules</span>
          </div>
          <div style="display: flex; align-items: center; justify-content: space-between; padding: 16px; background: rgba(34,197,94,0.05); border-radius: 12px;">
            <span style="font-weight: 600;">‚úÖ Aucune erreur</span>
            <span style="color: #22c55e; font-weight: 700;">0 erreur</span>
          </div>
        `;
        
        setTimeout(() => goToStep(3), 2000);
      }, 3000);
    }

    async function loginWithGoogle() {
      const { error } = await supabase.auth.signInWithOAuth({
        provider: 'google',
        options: {
          redirectTo: window.location.href
        }
      });
      
      if (error) alert('Erreur: ' + error.message);
    }

    async function createAccount() {
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;
      
      if (!email || !password) {
        alert('Email et mot de passe requis');
        return;
      }
      
      const { data, error } = await supabase.auth.signUp({ email, password });
      
      if (error) {
        alert('Erreur: ' + error.message);
        return;
      }
      
      goToPayment(email, data.user.id);
    }

    async function goToPayment(email, userId) {
      try {
        const response = await fetch(`${SUPABASE_URL}/functions/v1/create-checkout`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'apikey': SUPABASE_ANON_KEY
          },
          body: JSON.stringify({ email, userId, plan: 'monthly' })
        });
        
        const { url } = await response.json();
        window.location.href = url;
        
      } catch (error) {
        console.error('Erreur:', error);
        alert('Erreur lors de la cr√©ation du paiement');
      }
    }

    const urlParams = new URLSearchParams(window.location.search);
    if (urlParams.get('success') === 'true') {
      goToStep(4);
    } else if (urlParams.get('connected') === 'true') {
      goToStep(2);
      setTimeout(() => {
        document.getElementById('analysis-progress').innerHTML = `
          <div style="margin-bottom: 20px; padding: 16px; background: rgba(34,197,94,0.05); border-radius: 12px;">‚úÖ Connexion Google r√©ussie</div>
          <div style="margin-bottom: 20px; padding: 16px; background: rgba(34,197,94,0.05); border-radius: 12px;">‚úÖ R√©cup√©ration de tes Sheets</div>
          <div style="padding: 16px; background: rgba(34,197,94,0.05); border-radius: 12px;">‚úÖ Analyse termin√©e</div>
        `;
        setTimeout(() => goToStep(3), 2000);
      }, 2000);
    }
  </script>
</body>
</html>
